# Penetration Testing Preparation

## Scope

### In Scope
- All API endpoints (`/api/v1/*`)
- WebSocket connections (`/ws`)
- Authentication flows
- File upload/download
- Frontend application

### Out of Scope
- Third-party services (MinIO, Redis, PostgreSQL)
- DDoS attacks
- Social engineering

## Test Credentials

For testing purposes (disable in production):

```
Test User 1:
Phone: +15551234567
PIN: 1234
Recovery Key: abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon about

Test User 2:
Phone: +15559876543
PIN: 123456
```

## Known Endpoints

### Authentication
```
POST /api/v1/auth/request-code    # Request OTP
POST /api/v1/auth/verify          # Verify OTP
POST /api/v1/auth/register        # Create account
POST /api/v1/auth/pin/verify      # Verify PIN
POST /api/v1/auth/recover         # Account recovery
```

### User Management
```
GET  /api/v1/users/me             # Get current user
PUT  /api/v1/users/me             # Update profile
POST /api/v1/users/me/prekeys     # Upload prekeys
GET  /api/v1/users/:id/keys       # Get user's public keys
```

### Messaging
```
WS   /ws?token=<jwt>              # WebSocket connection
GET  /api/v1/messages             # Get message history
POST /api/v1/messages/:id/react   # Add reaction
```

### Media
```
POST /api/v1/media/upload-url     # Get presigned upload URL
GET  /api/v1/media/:id/download   # Get presigned download URL
```

## Attack Vectors to Test

### Authentication
- [ ] Brute force PIN (should lock after 5 attempts)
- [ ] OTP bypass attempts
- [ ] Session fixation
- [ ] Session hijacking (change IP/UA mid-session)
- [ ] Token replay after logout
- [ ] Recovery key brute force

### Authorization
- [ ] IDOR on messages (access other users' messages)
- [ ] IDOR on media (access other users' files)
- [ ] Group privilege escalation
- [ ] Admin function access

### Input Validation
- [ ] SQL injection on all parameters
- [ ] NoSQL injection on search
- [ ] XSS via profile fields
- [ ] Command injection
- [ ] Path traversal on file uploads
- [ ] SSRF via media URLs
- [ ] XML/JSON injection

### Cryptographic
- [ ] Weak key generation
- [ ] Key reuse detection
- [ ] Downgrade attacks
- [ ] Timing attacks on auth

### Business Logic
- [ ] Rate limit bypass
- [ ] Double-spend on prekeys
- [ ] Race conditions on message delivery
- [ ] Replay old messages

### WebSocket
- [ ] Unauthenticated access
- [ ] Cross-site WebSocket hijacking
- [ ] Message injection
- [ ] Large payload DoS

## Expected Security Controls

| Control | Expected Behavior |
|---------|-------------------|
| Rate Limiting | 100 req/min per IP |
| PIN Lockout | 5 failures â†’ 5 min lock |
| Session Timeout | 24 hours, rotated hourly |
| CORS | Strict origin validation |
| CSP | No inline scripts |
| Input Validation | All inputs sanitized |

## Reporting

Please report findings to security@[domain].com

Include:
- Vulnerability description
- Steps to reproduce
- Impact assessment
- Suggested remediation

## Legal

This testing is authorized only for the defined scope. Any testing outside the scope requires explicit written permission.

